<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/main}">
<head>
    <title>Все идеи</title>
</head>
<body>
<div layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="bi bi-collection"></i> Идеи для голосования</h1>
        <a th:href="@{/ideas/new}" class="btn btn-primary" sec:authorize="isAuthenticated()">
            <i class="bi bi-plus-circle"></i> Подать идею
        </a>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <form th:action="@{/ideas}" method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Тип заявки</label>
                    <select name="type" class="form-select">
                        <option value="">Все типы</option>
                        <option th:each="t : ${types}"
                                th:value="${t.name()}"
                                th:text="${t.displayName}"
                                th:selected="${selectedType != null && selectedType.name() == t.name()}">
                        </option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Статус</label>
                    <select name="status" class="form-select">
                        <option value="">Все статусы</option>
                        <option th:each="s : ${statuses}"
                                th:value="${s.name()}"
                                th:text="${s.displayName}"
                                th:selected="${selectedStatus != null && selectedStatus.name() == s.name()}">
                        </option>
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-outline-primary me-2">
                        <i class="bi bi-filter"></i> Фильтр
                    </button>
                    <a th:href="@{/ideas}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Сбросить
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Ideas List -->
    <div th:if="${ideas.isEmpty()}" class="alert alert-info">
        <i class="bi bi-info-circle"></i> Заявок пока нет. Будьте первым!
    </div>

    <div class="row">
        <div th:each="idea : ${ideas}" class="col-md-6 mb-4">
            <div class="card card-idea h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>
                        <span th:class="'badge badge-' + ${idea.type.name().toLowerCase()}"
                              th:text="${idea.type.displayName}"></span>
                        <span th:class="'badge status-' + ${idea.status.name().toLowerCase()}"
                              th:text="${idea.status.displayName}"></span>
                    </span>
                    <small class="text-muted" th:text="${idea.number}"></small>
                </div>
                <div class="card-body">
                    <h5 class="card-title">
                        <a th:href="@{/ideas/{number}(number=${idea.number})}"
                           th:text="${idea.title}" class="text-decoration-none"></a>
                    </h5>
                    <p class="card-text text-muted"
                       th:text="${#strings.abbreviate(idea.description, 150)}"></p>

                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            <i class="bi bi-person"></i>
                            <span th:text="${idea.authorName}"></span>
                        </small>
                        <small class="text-muted">
                            <i class="bi bi-building"></i>
                            <span th:text="${idea.teamName}"></span>
                        </small>
                    </div>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span>
                        <i class="bi bi-hand-thumbs-up"></i>
                        <span th:text="${idea.totalVotes}">0</span> голосов
                    </span>
                    <span>
                        <i class="bi bi-chat"></i>
                        <span th:text="${idea.comments.size()}">0</span>
                    </span>
                    <small class="text-muted" th:text="${#temporals.format(idea.createdAt, 'dd.MM.yyyy')}"></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <nav th:if="${ideas.totalPages > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${ideas.first} ? 'disabled'">
                <a class="page-link" th:href="@{/ideas(page=${ideas.number - 1}, type=${selectedType}, status=${selectedStatus})}">
                    <i class="bi bi-chevron-left"></i>
                </a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, ideas.totalPages - 1)}"
                class="page-item"
                th:classappend="${i == ideas.number} ? 'active'">
                <a class="page-link" th:href="@{/ideas(page=${i}, type=${selectedType}, status=${selectedStatus})}" th:text="${i + 1}"></a>
            </li>
            <li class="page-item" th:classappend="${ideas.last} ? 'disabled'">
                <a class="page-link" th:href="@{/ideas(page=${ideas.number + 1}, type=${selectedType}, status=${selectedStatus})}">
                    <i class="bi bi-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
</div>
</body>
</html>
